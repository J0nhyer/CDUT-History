成都理工大学数字校史馆项目 - 完整技术知识库文档
生成时间：2025年11月25日


==========================================
第一部分：项目概述
==========================================

项目名称：成都理工大学数字校史馆（CDUT Digital History）
项目定位：成都理工大学数字记忆平台
核心功能：AI智能问答、历史事件展示、人物介绍、知识图谱可视化、游戏化探索
技术特色：AI大模型集成、3D可视化、响应式编程、RAG知识检索增强

项目架构：前后端分离
前端技术：Vue 3 + Vite + Element Plus + Three.js
后端技术：Spring Boot 3 + Spring WebFlux + MyBatis Plus
数据库：MySQL 8.0
AI服务：阿里云通义千问（DashScope）


==========================================
第二部分：AI智能问答系统详解
==========================================

一、AI系统核心能力

1. 大模型集成
   使用阿里云百炼平台（DashScope）
   主对话模型：qwen-plus 和 qwen-max
   嵌入模型：text-embedding-v3
   API基础地址：https://dashscope.aliyuncs.com
   
2. 模型参数配置
   Temperature（温度参数）：0.2（控制生成随机性，值越小越确定）
   Max Tokens（最大令牌数）：1024
   Request Timeout（请求超时）：35秒
   
3. API密钥管理
   通过环境变量 TONG_YI_MODEL 注入API密钥
   配置文件中使用 ${TONG_YI_MODEL} 占位符
   遵循安全最佳实践，不在代码中硬编码密钥


二、RAG检索增强生成技术

RAG（Retrieval-Augmented Generation）是AI系统的核心技术，通过检索知识库增强大模型回答的准确性。

1. 知识库服务架构
   DatabaseKnowledgeBaseService：基于MySQL数据库的知识检索
   TextKnowledgeBaseService：基于文本文件的知识检索
   支持多种检索策略：FAQ匹配、同义词扩展、全文搜索、关键词搜索

2. 知识检索流程
   步骤1：检查问题中的FAQ常见问题，优先匹配
   步骤2：如果FAQ不足，进行同义词扩展匹配
   步骤3：执行全文搜索（使用MySQL FULLTEXT索引）
   步骤4：补充关键词搜索
   步骤5：根据问题类型加载Few-shot示例
   步骤6：始终包含系统提示词（system_prompt）
   
3. 知识库分类体系
   system_prompt：系统提示词（最高优先级）
   faq：常见问题快速匹配
   synonym：同义词映射
   school_history：学校历史
   person：人物信息
   event：历史事件
   discipline：学科专业
   culture：校园文化
   general：通用知识
   few_shot：示例问答

4. 智能问题分类
   人物查询：检测关键词（谁、院士、教授、校长、人物、介绍）
   历史事件：检测关键词（哪年、什么时候、历史、建校、成立、发展）
   统计数据：检测关键词（几个、多少、有多少、数量、统计）
   学科专业：检测关键词（专业、学科、学院、优势、特色）

5. 知识优先级机制
   使用priority字段（1-10）设置知识重要性
   系统提示词和核心知识设置高优先级（10）
   常规知识设置中等优先级（5-7）
   辅助信息设置低优先级（1-3）


三、流式对话实现（SSE技术）

1. SSE（Server-Sent Events）协议
   单向通信：服务器主动推送数据到客户端
   基于HTTP协议：无需WebSocket，更简单稳定
   自动重连：浏览器原生支持断线重连
   
2. 后端实现细节
   使用Spring WebFlux的Flux响应式流
   BailianClient封装阿里云API调用
   流式解析SSE数据块
   实时推送AI生成的文字片段
   
3. 前端接收处理
   使用Axios处理流式响应
   设置responseType为stream
   监听data事件接收数据块
   实时更新UI显示AI回复
   支持流式文本动画效果


四、多轮对话上下文管理

1. 会话（Session）管理
   每个对话创建唯一session_id（UUID生成）
   存储会话标题（取第一个问题的前30字符）
   记录会话创建时间、更新时间
   统计消息总数
   支持用户ID关联（可选）

2. 消息（Message）存储
   每条消息有唯一message_id
   记录角色role：system（系统）、user（用户）、assistant（AI助手）
   保存完整消息内容content
   记录使用的模型model
   保存温度参数temperature
   可选记录token数量和引用的知识库

3. 上下文加载策略
   加载最近10条历史消息作为上下文
   消息按时间顺序排列
   系统提示词始终在最前面
   历史对话在中间
   当前问题在最后

4. 会话API接口
   创建会话：POST /api/chat/session
   获取会话列表：GET /api/chat/sessions
   获取会话消息：GET /api/chat/session/{sessionId}/messages
   删除会话：DELETE /api/chat/session/{sessionId}


五、AI服务核心类详解

1. BailianClient（百炼客户端）
   职责：封装阿里云百炼API调用
   主要方法：streamChat（流式聊天）
   处理SSE数据流解析
   错误处理和重试机制
   支持知识库ID传入

2. EnhancedAiAssistantService（增强型AI助手服务）
   整合知识库检索和对话管理
   方法streamChatWithContext：
     - 创建或获取会话
     - 加载历史消息
     - 构建知识上下文
     - 调用大模型API
     - 保存对话记录
   
3. DatabaseKnowledgeBaseService（数据库知识库服务）
   方法buildKnowledgeContext：构建知识上下文
   方法matchQuestion：FAQ问题匹配
   方法matchSynonym：同义词匹配
   方法classifyQuestion：智能问题分类
   方法extractKeywords：关键词提取
   
4. ChatContextService（聊天上下文服务）
   方法createSession：创建新会话
   方法getSessionMessages：获取会话消息
   方法saveMessage：保存消息记录
   方法deleteSession：删除会话
   方法updateSessionTitle：更新会话标题


六、Prompt工程

1. 系统提示词设计
   定义AI助手身份："成都理工大学的AI校史助手"
   明确回答范围："专门回答关于学校历史、人物、事件等问题"
   设定回答风格：准确、专业、友好
   
2. 知识上下文注入
   将检索到的知识库内容拼接到系统提示词
   格式：标题 + 内容，使用换行符分隔
   限制知识条数（默认5条）避免超过token限制
   
3. Few-shot示例学习
   提供问答示例帮助AI理解回答模式
   示例分类：人物查询、历史事件、统计数据、学科专业
   每个类别提供1-2个典型示例


==========================================
第三部分：后端技术栈详解
==========================================

一、核心框架

1. Spring Boot 3.2.6
   应用启动和自动配置
   简化Spring应用开发
   内置Tomcat服务器
   支持profiles多环境配置
   
2. Spring Web
   RESTful API开发
   @RestController注解支持
   自动JSON序列化/反序列化
   统一异常处理
   跨域CORS配置
   
3. Spring WebFlux
   响应式Web编程
   支持Reactor响应式流
   高并发异步处理
   非阻塞IO
   适合流式数据传输（SSE）
   
4. Spring Security
   用户认证和授权
   BCrypt密码加密
   基于角色的访问控制
   自定义SecurityFilterChain
   CSRF保护配置
   
5. Spring Validation
   请求参数验证
   @Valid注解自动校验
   自定义验证规则
   统一错误响应格式


二、数据库与持久化

1. MyBatis Plus 3.5.11
   增强的MyBatis框架
   BaseMapper提供CRUD方法
   无需编写XML配置
   支持Lambda查询
   自动分页插件
   逻辑删除支持
   
2. MySQL Connector
   JDBC驱动程序
   连接MySQL 8.0数据库
   连接池管理
   字符集UTF-8配置
   时区UTC设置
   
3. 数据源配置
   URL：jdbc:mysql://localhost:3306/javawebdb
   用户名：root
   密码：空（开发环境）
   驱动类：com.mysql.cj.jdbc.Driver
   
4. MyBatis映射配置
   Mapper接口位于 org.cdut.ai.mapper 包
   XML映射文件位于 classpath:/mapper/**/*.xml
   自动扫描Entity实体类


三、API文档工具

1. Knife4j 4.3.0
   基于Swagger的API文档增强工具
   自动生成API文档
   在线测试接口
   访问地址：http://localhost:8080/doc.html
   支持分组和标签
   美化的UI界面


四、工具库

1. Lombok
   @Data：自动生成getter/setter/toString/equals/hashCode
   @Slf4j：自动注入日志对象
   @Builder：建造者模式
   @NoArgsConstructor/@AllArgsConstructor：构造函数
   减少样板代码
   
2. Jackson
   JSON序列化/反序列化
   自动处理日期格式
   支持复杂对象转换
   配置驼峰命名映射
   
3. Maven
   项目构建管理
   依赖管理
   版本控制
   打包部署


五、项目结构

后端项目结构（org.cdut.ai包）：

client/
  - BailianClient.java：阿里云百炼API客户端封装

config/
  - AliBailianProperties.java：百炼配置属性
  - SecurityConfig.java：Spring Security配置
  - WebClientConfig.java：WebClient配置

controller/
  - AiAssistantController.java：AI助手API
  - ChatContextController.java：聊天上下文API
  - PersonController.java：人物信息API
  - HistoryController.java：历史事件API
  - AcademicUniverseController.java：学科星河API
  - UserController.java：用户管理API
  - KnowledgeBaseController.java：知识库管理API
  ... 其他控制器

dto/
  - ChatRequest.java：聊天请求DTO
  - ChatMessage.java：聊天消息DTO
  - PersonDTO.java：人物数据传输对象
  ... 其他DTO

mapper/
  - PersonMapper.java：人物数据访问接口
  - KnowledgeBaseMapper.java：知识库数据访问接口
  - ChatSessionMapper.java：会话数据访问接口
  - ChatMessageMapper.java：消息数据访问接口
  ... 其他Mapper

model/
  - Person.java：人物实体
  - KnowledgeBase.java：知识库实体
  - ChatSession.java：会话实体
  - ChatMessage.java：消息实体
  - HistoryEvent.java：历史事件实体
  - PersonProfile.java：人物档案实体
  - PersonEvent.java：人物事件实体
  - AcademicNode.java：学术节点实体
  ... 其他实体类

service/
  - EnhancedAiAssistantService.java：增强AI助手服务
  - DatabaseKnowledgeBaseService.java：数据库知识库服务
  - ChatContextService.java：聊天上下文服务
  - PersonService.java：人物业务服务
  - HistoryService.java：历史业务服务
  - UserService.java：用户业务服务
  ... 其他服务接口

service/impl/
  - PersonServiceImpl.java：人物服务实现
  - HistoryServiceImpl.java：历史服务实现
  - UserServiceImpl.java：用户服务实现
  - AcademicUniverseServiceImpl.java：学科星河服务实现


六、Java版本与配置

JDK版本：Java 17
编译器源码版本：17
编译器目标版本：17
Maven编译器插件版本：3.10.1
项目版本：1.0-SNAPSHOT
项目groupId：cn.cdlg
项目artifactId：java-ai-langchain4j


==========================================
第四部分：前端技术栈详解
==========================================

一、核心框架

1. Vue 3.5.13
   组合式API（Composition API）
   响应式系统（Reactivity）
   生命周期钩子（Lifecycle Hooks）
   模板语法和指令
   组件化开发
   
2. Vue Router 4.2.5
   客户端路由管理
   路由懒加载
   路由守卫
   动态路由匹配
   嵌套路由支持
   
3. Vite 5.4.8
   新一代前端构建工具
   极速的开发服务器启动
   即时模块热更新（HMR）
   按需编译
   生产环境优化打包
   开发端口：3000


二、UI组件库

1. Element Plus 2.8.4
   基于Vue 3的组件库
   丰富的UI组件
   响应式设计
   国际化支持
   主题定制
   
2. Element Plus Icons 2.3.1
   官方图标库
   矢量图标
   按需引入
   丰富的图标资源


三、3D可视化技术

1. Three.js 0.180.0
   WebGL 3D图形渲染引擎
   
   核心概念：
   - Scene（场景）：3D世界的容器
   - Camera（相机）：观察视角
   - Renderer（渲染器）：将场景渲染到画布
   - Mesh（网格）：3D对象（几何体+材质）
   - Light（光源）：照明系统
   
   几何体（Geometry）：
   - BoxGeometry：立方体
   - SphereGeometry：球体
   - PlaneGeometry：平面
   - CylinderGeometry：圆柱体
   
   材质（Material）：
   - MeshBasicMaterial：基础材质（不受光照影响）
   - MeshStandardMaterial：标准材质（PBR物理渲染）
   - MeshPhongMaterial：高光材质
   - ShaderMaterial：自定义着色器
   
   相机类型：
   - PerspectiveCamera：透视相机（模拟人眼）
   - OrthographicCamera：正交相机（2D投影）
   
   光照类型：
   - AmbientLight：环境光（均匀照亮所有物体）
   - DirectionalLight：平行光（太阳光）
   - PointLight：点光源（灯泡）
   - SpotLight：聚光灯
   
2. 3d-force-graph 1.79.0
   3D力导向图可视化库
   基于Three.js和d3-force
   
   应用场景：
   - 学科知识图谱展示
   - 人物关系网络
   - 学术节点连接
   
   主要特性：
   - 节点和连线可视化
   - 力导向布局算法
   - 交互式拖拽
   - 缩放和旋转
   - 节点点击事件


四、数据可视化

1. D3.js 7.9.0
   数据驱动的文档操作库
   
   核心功能：
   - 数据绑定：将数据绑定到DOM元素
   - SVG操作：创建和操作SVG图形
   - 比例尺（Scale）：数据映射
   - 坐标轴（Axis）：图表坐标系
   - 力导向布局（Force Layout）：节点关系图
   
   应用场景：
   - 知识图谱节点布局
   - 时间线可视化
   - 数据统计图表


五、动画库

1. GSAP 3.13.0
   专业级JavaScript动画库
   
   核心API：
   - gsap.to()：补间动画到目标状态
   - gsap.from()：从某状态开始动画
   - gsap.fromTo()：指定起始和结束状态
   - gsap.timeline()：时间线管理多个动画
   
   缓动函数（Easing）：
   - power1/2/3/4：不同强度的加速
   - elastic：弹性效果
   - bounce：弹跳效果
   - circ：圆形缓动
   
   应用场景：
   - 页面元素进入动画
   - 滚动视差效果
   - 按钮交互动效
   - 页面切换过渡
   
2. AOS 2.3.4
   滚动动画库（Animate On Scroll）
   
   使用方式：
   - data-aos属性指定动画类型
   - data-aos-duration指定持续时间
   - data-aos-delay指定延迟
   
   预设动画：
   - fade-up/down/left/right：淡入
   - zoom-in/out：缩放
   - flip-left/right：翻转
   - slide-up/down：滑动
   
   应用场景：
   - 历史事件卡片滚动显示
   - 人物信息渐入效果
   - 时间线节点动画


六、网络请求

1. Axios 1.7.7
   Promise based HTTP客户端
   
   特性：
   - 支持Promise API
   - 请求/响应拦截器
   - 自动JSON转换
   - 错误处理
   - 取消请求
   - 并发请求
   
   拦截器应用：
   - 请求拦截：添加token、设置Content-Type
   - 响应拦截：统一错误处理、数据格式化
   
   流式数据处理：
   - 设置responseType为stream
   - 监听onDownloadProgress
   - 处理SSE事件流


七、工具库

1. UUID 10.0.0
   生成唯一标识符
   v4()：生成随机UUID
   应用：会话ID、消息ID生成
   
2. classlist-polyfill
   classList API兼容性填充
   支持旧浏览器
   add/remove/toggle类名操作


==========================================
待续...（文档将继续扩展）
==========================================
