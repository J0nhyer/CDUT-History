# 时间线功能使用说明（环形循环版）

## 功能概述
人物详细页面中的生平时间线，采用3D翻页交互方式展示人物生平事件。
✨ **支持双向翻页和无限循环浏览！**

---

## 快速启动

### 1. 后端准备
1. 确保MySQL数据库 `javawebdb` 已启动
2. 执行SQL初始化脚本：
   ```
   路径：BackWeb\BackWeb\src\main\resources\sql\init_person_timeline.sql
   ```
   
   该脚本会：
   - 创建 `person_event` 表（如果不存在）
   - 插入李大钊的时间线数据（7个重要事件）

3. 启动后端服务：运行 `BackWebApplication`

### 2. 前端准备
```bash
cd FrontisWeb-ui\FrontisWeb-ui
npm install        # 首次运行
npm run serve      # 启动开发服务器
```
访问：http://localhost:8081

### 3. 查看时间线
1. 进入人物详细页面（例如李大钊的页面）
2. 点击"生平时间线"标签
3. 使用以下方式翻页：
   - 👆 **向上拖动**：翻到下一页
   - 👇 **向下拖动**：返回上一页
   - ⌨️ **↑ 键**：快速向前翻页
   - ⌨️ **↓ 键**：快速向后翻页

---

## 主要特性

### 1. 环形循环翻页 ♾️
- **无限循环**：从最后一页继续向前翻，会自动循环到第一页
- **双向浏览**：可以随时向前或向后翻页
- **连续体验**：没有"开始"和"结束"的边界感
- **智能映射**：使用虚拟索引系统，实现真正的环形循环

### 2. 交互方式
| 操作 | 效果 |
|------|------|
| 向上拖动 | 翻到下一页 |
| 向下拖动已翻页面 | 返回上一页 |
| ↑ 键 | 快速向前翻页 |
| ↓ 键 | 快速向后翻页 |
| 拖动超过60° | 自动完成翻页 |
| 拖动不足60° | 自动回弹 |

**特殊效果：**
- 上一页会半透明显示（opacity: 0.5），可以拖回查看
- 旋转轴在页面顶部，模拟真实日历翻页

### 3. 视觉效果
- ✅ 3D翻转动画（`rotateX`，旋转轴在顶部）
- ✅ 页面堆叠效果（z-index + transform）
- ✅ 实时阴影渐变
- ✅ 页面正反面内容
- ✅ 平滑的翻页过渡

### 4. 内容展示

#### 正面
- 📅 时间标签（大字号年份）
- 📌 事件标题
- 🏷️ 分类标签（出生、教育、职业等）
- 📝 详细描述
- ⭐ 重要性标识（高重要度事件）
- 💡 拖动提示："👆向上翻页 👇向下返回"

#### 背面
- 📅 年份
- ℹ️ "更多信息"标题
- 👤 人物名称
- 📚 分类和数据来源
- ➡️ 继续翻页提示

### 5. 进度追踪
- 📊 底部进度条显示当前位置（循环）
- 📄 显示 "第X页/共Y页（循环）"
- ♾️ 支持无限浏览，没有"完成"概念

---

## 技术实现

### 虚拟索引系统
```javascript
// displayIndex: 虚拟连续索引（可以是任意整数）
// realIndex: 实际事件索引（0 ~ n-1）
realIndex = ((displayIndex % totalEvents) + totalEvents) % totalEvents
```

**示例：共5个事件**
```
displayIndex = -2 → realIndex = 3（第4页）
displayIndex = -1 → realIndex = 4（第5页）
displayIndex = 0  → realIndex = 0（第1页）
displayIndex = 5  → realIndex = 0（第1页）循环回来
displayIndex = 6  → realIndex = 1（第2页）
```

### 动态页面窗口
- 始终显示当前页前后各2页（共5页）
- 使用模运算自动循环映射内容
- 无缝切换，无跳跃感

---

## 数据说明

### person_event 表结构
```sql
CREATE TABLE person_event (
  event_id INT PRIMARY KEY AUTO_INCREMENT,
  person_id INT NOT NULL,
  person_name VARCHAR(100),
  year INT,
  event_category VARCHAR(50),
  title VARCHAR(200),
  description TEXT,
  importance VARCHAR(20),
  source VARCHAR(200),
  sort_order INT
);
```

### 事件分类（event_category）
| 分类 | 说明 | 图标 |
|------|------|------|
| birth | 出生 | 🎂 |
| education | 教育 | 🎓 |
| career | 职业 | 💼 |
| honor | 荣誉 | 🏆 |
| achievement | 成就 | 🏅 |
| death | 逝世 | ✝️ |

### 重要性（importance）
- `high`：高重要度（显示⭐特殊标识）
- `medium`：中等
- `low`：低

---

## 文件位置

### 前端
- **主组件**：`FrontisWeb-ui\FrontisWeb-ui\src\components\TimelineFlipBook.vue`
- **父组件**：`FrontisWeb-ui\FrontisWeb-ui\src\components\PersonDetailAcademic.vue`

### 后端
- **SQL脚本**：`BackWeb\BackWeb\src\main\resources\sql\init_person_timeline.sql`
- **API端点**：`/api/person/{personId}/events`

---

## 配置参数

在 `TimelineFlipBook.vue` 的 `data` 中可调整：

```javascript
data() {
  return {
    flipThresholdAngle: 60,     // 完成翻页的角度阈值（度）
    minFlipDistance: 24,        // 开始拖动的最小距离（像素）
    enableLoop: true            // 启用循环模式（true=循环，false=线性）
  }
}
```

---

## 常见问题

### Q: 为什么看不到时间线？
**A:** 
1. 检查后端API是否正常返回数据
2. 检查 `person_event` 表中是否有对应 `person_id` 的数据
3. 打开浏览器控制台查看是否有错误

### Q: 翻页动画不流畅？
**A:** 
检查浏览器是否支持CSS 3D transforms，建议使用Chrome/Edge最新版本

### Q: 如何添加自己的人物时间线？
**A:** 
在 `person_event` 表中插入数据，确保：
- `person_id` 对应人物ID
- `sort_order` 递增（建议格式：YYYYMMDD）

### Q: 可以关闭循环模式吗？
**A:** 
在 `TimelineFlipBook.vue` 的 `data` 中设置 `enableLoop: false`

### Q: 循环模式下如何知道看到哪一页了？
**A:** 
查看底部进度条，显示"第X页/共Y页（循环）"

### Q: 为什么有的页面半透明？
**A:** 
那是已经翻过的上一页，可以向下拖动它来返回上一页

---

## 扩展建议

- [x] 双向翻页（已实现）
- [x] 无限循环（已实现）
- [x] 旋转轴在顶部（已实现）
- [ ] 添加图片支持（在事件描述中）
- [ ] 支持视频/音频附件
- [ ] 添加时间线的时间轴视图切换
- [ ] 支持导出为PDF
- [ ] 添加分享功能
- [ ] 添加书签功能（标记重要事件）
- [ ] 支持全屏模式
- [ ] 触摸手势优化
- [ ] 添加音效反馈

---

## 版本信息

- **版本**：v2.0（环形循环版）
- **更新时间**：2025-11-23
- **核心特性**：双向翻页 + 无限循环
- **兼容性**：Chrome 90+, Firefox 88+, Safari 14+, Edge 90+

---

## 开发者备注

### 核心算法
```javascript
// 1. 虚拟索引映射
const realIndex = ((displayIndex % totalEvents) + totalEvents) % totalEvents

// 2. 动态页面生成
visibleEvents() {
  const visible = []
  for (let i = -2; i <= 2; i++) {
    const displayIndex = this.currentPageIndex + i
    const realIndex = ((displayIndex % totalEvents) + totalEvents) % totalEvents
    visible.push({ ...this.events[realIndex], displayIndex, realIndex })
  }
  return visible
}

// 3. 页面样式计算
const offset = displayIndex - currentPageIndex
// offset=-1: 上一页（已翻过）
// offset=0:  当前页
// offset>0:  后续页面
```

### 性能优化
- 只渲染5个页面（当前页前后各2页）
- 使用 `will-change` 提示GPU加速
- 动画使用 `transform` 和 `opacity`，避免触发重排
- 适当的 `transition` 时间（420ms）平衡流畅度和响应

---

**Enjoy! 🎉**
